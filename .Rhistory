knitr::opts_chunk$set(echo = TRUE)
categoricals = c('DDA', 'DIRDEP', 'NSF', 'TELLER', 'SAV',
'ATM', 'CD', 'IRA', 'INV', 'MM', 'CC',
'SDB', 'INAREA', 'INS', 'BRANCH')
ins_t = ins_t %>%
mutate(across(categoricals,
as.factor))
library(tidyverse)
library(earth)         # MARS
install.packages("earth")
library(tidyverse)
library(earth)         # MARS
library(segmented)     # piecewise (segmented) regression
install.packages("segmented")
install.packages(c("splines", "mgcv", "caret", "Metrics", "DescTools"))
library(tidyverse)
library(earth)         # MARS
library(segmented)     # piecewise (segmented) regression
library(splines)       # regression splines (bs, ns) - kept for reference
library(mgcv)          # smoothing splines via GAM
library(caret)         # data splitting / utilities
library(Metrics)       # rmse, mse helpers (plus we'll compute R2 manually)
library(DescTools)
ins_t_raw = readr::read_csv('./insurance_t.csv')
ins_t = data.frame(ins_t_raw)
categoricals = c('DDA', 'DIRDEP', 'NSF', 'TELLER', 'SAV',
'ATM', 'CD', 'IRA', 'INV', 'MM', 'CC',
'SDB', 'INAREA', 'INS', 'BRANCH')
ins_t = ins_t %>%
mutate(across(categoricals,
as.factor))
ins_t
missing = ins_t %>%
summarize(across(everything(),
~sum(is.na(.)))) %>%
t() %>%
as.data.frame() %>%
mutate(n_missing = V1) %>%
dplyr::select(!V1) %>%
filter(n_missing > 0)
missing_cols = missing %>% rownames()
# missing columns subsets for numeric and categorical data, respectively
missing_num = setdiff(missing_cols, categoricals)
missing_fctr = intersect(missing_cols, categoricals)
ins_t = ins_t %>%
# new missingness indicator column for each column with missingness
mutate(
across(
.cols = all_of(missing_cols),
.fns = ~ .x %>%
is.na() %>%
as.numeric() %>%
as.factor(),
.names = '{col}_is_imputed'
)
) %>%
# Continuous variables: median imputation
mutate(
across(all_of(missing_num),
~ replace_na(.x, median(.x, na.rm = T))
)
) %>%
# Categorical variables: mode imputation
mutate(
across(all_of(missing_fctr),
~ replace_na(.x, Mode(.x, na.rm = T)))
)
ins_t %>%
summarize(across(everything(),
~sum(is.na(.)))) %>%
t()
ins_t_raw = readr::read_csv('./insurance_t.csv')
ins_t = data.frame(ins_t_raw)
categoricals = c('DDA', 'DIRDEP', 'NSF', 'TELLER', 'SAV',
'ATM', 'CD', 'IRA', 'INV', 'MM', 'CC',
'SDB', 'INAREA', 'INS', 'BRANCH')
ins_t = ins_t %>%
mutate(across(categoricals,
as.factor))
ins_t
ins_t %>%
summarize(across(everything(),
~sum(is.na(.)))) %>%
t()
missing = ins_t %>%
summarize(across(everything(),
~sum(is.na(.)))) %>%
t() %>%
as.data.frame() %>%
mutate(n_missing = V1) %>%
dplyr::select(!V1) %>%
filter(n_missing > 0)
missing_cols = missing %>% rownames()
missing_cols
missing_num = setdiff(missing_cols, categoricals)
missing_fctr = intersect(missing_cols, categoricals)
missing = ins_t %>%
summarize(across(everything(),
~sum(is.na(.)))) %>%
t() %>%
as.data.frame() %>%
mutate(n_missing = V1) %>%
dplyr::select(!V1) %>%
filter(n_missing > 0)
missing_cols = missing %>% rownames()
# missing columns subsets for numeric and categorical data, respectively
missing_num = setdiff(missing_cols, categoricals)
missing_fctr = intersect(missing_cols, categoricals)
ins_t = ins_t %>%
# new missingness indicator column for each column with missingness
mutate(
across(
.cols = all_of(missing_cols),
.fns = ~ .x %>%
is.na() %>%
as.numeric() %>%
as.factor(),
.names = '{col}_is_imputed'
)
) %>%
# Continuous variables: median imputation
mutate(
across(all_of(missing_num),
~ replace_na(.x, median(.x, na.rm = T))
)
) %>%
# Categorical variables: mode imputation
mutate(
across(all_of(missing_fctr),
~ replace_na(.x, Mode(.x, na.rm = T)))
)
gam1 <- gam(INS ~ s(., k=9), data=ins_t, method="REML", family = binomial(link="logit"))
colnames(ins_t)
categoricals = c('DDA', 'DIRDEP', 'NSF', 'TELLER', 'SAV',
'ATM', 'CD', 'IRA', 'INV', 'MM', 'CC',
'SDB', 'INAREA', 'INS', 'BRANCH')
ins_t = ins_t %>%
mutate(across(categoricals,
as.factor))
ins_t
missing = ins_t %>%
summarize(across(everything(),
~sum(is.na(.)))) %>%
t() %>%
as.data.frame() %>%
mutate(n_missing = V1) %>%
dplyr::select(!V1) %>%
filter(n_missing > 0)
missing_cols = missing %>% rownames()
# missing columns subsets for numeric and categorical data, respectively
missing_num = setdiff(missing_cols, categoricals)
missing_fctr = intersect(missing_cols, categoricals)
ins_t = ins_t %>%
# # new missingness indicator column for each column with missingness
# mutate(
#   across(
#     .cols = all_of(missing_cols),
#     .fns = ~ .x %>%
#       is.na() %>%
#       as.numeric() %>%
#       as.factor(),
#     .names = '{col}_is_imputed'
#   )
# ) %>%
# Continuous variables: median imputation
mutate(
across(all_of(missing_num),
~ replace_na(.x, median(.x, na.rm = T))
)
) %>%
# Categorical variables: mode imputation
mutate(
across(all_of(missing_fctr),
~ replace_na(.x, Mode(.x, na.rm = T)))
)
ins_t.head(5)
head(ins_t, n=5)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(earth)         # MARS
library(segmented)     # piecewise (segmented) regression
library(splines)       # regression splines (bs, ns) - kept for reference
library(mgcv)          # smoothing splines via GAM
library(caret)         # data splitting / utilities
library(Metrics)       # rmse, mse helpers (plus we'll compute R2 manually)
library(DescTools)
ins_t_raw = readr::read_csv('./insurance_t.csv')
ins_t = data.frame(ins_t_raw)
categoricals = c('DDA', 'DIRDEP', 'NSF', 'TELLER', 'SAV',
'ATM', 'CD', 'IRA', 'INV', 'MM', 'CC',
'SDB', 'INAREA', 'INS', 'BRANCH')
ins_t = ins_t %>%
mutate(across(categoricals,
as.factor))
ins_t
missing = ins_t %>%
summarize(across(everything(),
~sum(is.na(.)))) %>%
t() %>%
as.data.frame() %>%
mutate(n_missing = V1) %>%
dplyr::select(!V1) %>%
filter(n_missing > 0)
missing_cols = missing %>% rownames()
# missing columns subsets for numeric and categorical data, respectively
missing_num = setdiff(missing_cols, categoricals)
missing_fctr = intersect(missing_cols, categoricals)
ins_t = ins_t %>%
# # new missingness indicator column for each column with missingness
# mutate(
#   across(
#     .cols = all_of(missing_cols),
#     .fns = ~ .x %>%
#       is.na() %>%
#       as.numeric() %>%
#       as.factor(),
#     .names = '{col}_is_imputed'
#   )
# ) %>%
# Continuous variables: median imputation
mutate(
across(all_of(missing_num),
~ replace_na(.x, median(.x, na.rm = T))
)
) %>%
# Categorical variables: mode imputation
mutate(
across(all_of(missing_fctr),
~ replace_na(.x, Mode(.x, na.rm = T)))
)
head(ins_t, n=5)
colnames(ins_t)
# 1. Get all your predictor names (assuming 'ins_t' has all 38)
outcome_var <- "INS"
predictor_vars <- setdiff(colnames(ins_t), outcome_var)
# 2. Separate numeric predictors from factor/character predictors
# We only want to apply s() to numeric variables.
numeric_predictors <- predictor_vars[sapply(ins_t[predictor_vars], is.numeric)]
factor_predictors <- predictor_vars[sapply(ins_t[predictor_vars], is.factor) |
sapply(ins_t[predictor_vars], is.character)]
# 3. Create the string for smooth terms (for numeric vars)
# This creates "s(var1, k=9) + s(var2, k=9) + ..."
smooth_terms <- paste0("s(", numeric_predictors, ", k=9)", collapse = " + ")
# 4. Create the string for linear terms (for factor vars)
# This creates "fctr1 + fctr2 + ..."
linear_terms <- paste(factor_predictors, collapse = " + ")
# 5. Combine them into one formula string
# We check if there are any factor variables to add
if (length(factor_predictors) > 0) {
formula_string <- paste(outcome_var, "~", smooth_terms, "+", linear_terms)
} else {
formula_string <- paste(outcome_var, "~", smooth_terms)
}
# 6. Convert the string to a formula object
gam_formula <- as.formula(formula_string)
# You can print the formula to see what it looks like:
print(gam_formula)
#Variable selection
numerics = setdiff(colnames(ins_t), categoricals)
numerics
#Variable selection
numerics = setdiff(colnames(ins_t), categoricals)
ins_t$CHECKS
numerics
where(is.numeric(ins_t))
sapply(ins_t, is.numeric)
where(sapply(ins_t, is.numeric))
sapply(ins_t, is.numeric)
sapply(ins_t, is.numeric)==TRUE
sapply(ins_t, is.numeric)[sapply(ins_t, is.numeric)==TRUE]
names(sapply(ins_t, is.numeric)[sapply(ins_t, is.numeric)==TRUE])
numerics
names(sapply(ins_t, is.numeric)[sapply(ins_t, is.numeric)==TRUE]) ==numerics
ins_t_s <- ins_t %>%
mutate(across(where(is.numeric), scale))
View(ins_t_s)
#Variable selection
#Standardize
ins_t_s <- ins_t %>%
mutate(across(where(is.numeric), scale))
#Perform Lasso regression on training data
x_train <- model.matrix(INS ~ ., ins_t_s)[, -1]
y_train <- ins_t_s$INS
set.seed(123)
cv_lasso <- cv.glmnet(x_train, y_train, alpha = 1, nfolds = 10)
install.packages("glmnet")
library(tidyverse)
library(earth)         # MARS
library(segmented)     # piecewise (segmented) regression
library(splines)       # regression splines (bs, ns) - kept for reference
library(mgcv)          # smoothing splines via GAM
library(caret)         # data splitting / utilities
library(Metrics)       # rmse, mse helpers (plus we'll compute R2 manually)
library(DescTools)
library(glmnet)
#Variable selection
#Standardize
ins_t_s <- ins_t %>%
mutate(across(where(is.numeric), scale))
#Perform Lasso regression on training data
x_train <- model.matrix(INS ~ ., ins_t_s)[, -1]
y_train <- ins_t_s$INS
set.seed(123)
cv_lasso <- cv.glmnet(x_train, y_train, alpha = 1, nfolds = 10)
x_train
y_train
ins_t_s <- ins_t %>%
mutate(across(where(is.numeric), scale))
x_train <- model.matrix(INS ~ ., ins_t_s)[, -1]
y_train <- ins_t_s$INS
set.seed(123)
cv_lasso <- cv.glmnet(x_train, y_train, alpha = 1, nfolds = 10)
#Variable selection
#Standardize
ins_t_s <- ins_t %>%
mutate(across(where(is.numeric), scale))
#Perform Lasso regression on training data
x_train <- model.matrix(INS ~ ., ins_t_s)[, -1]
y_train <- ins_t_s$INS
set.seed(123)
cv_lasso <- cv.glmnet(x_train, y_train, alpha = 1, nfolds = 10, family = binomial(link=logit))
summary(cv_lasso)
cv_lasso_lambda = cv_lasso$lambda.1se
coef(cv_lasso, s = cv_lasso_lambda)
best_lambda = cv_lasso$lambda.min
coef(cv_lasso, s = best_lambda)
best_lambda = cv_lasso$lambda.min
coefs = as.matrix(coef(cv_lasso, s = best_lambda))
nonzero = coefs[coefs != 0, , drop = FALSE]
nonzero
ins_t$INVBAL
#Variable selection
#Standardize
ins_t_s <- ins_t %>%
mutate(across(where(is.numeric), scale))
#Perform Lasso regression on training data
x_train <- model.matrix(INS ~ ., ins_t_s)[, -1]
y_train <- ins_t_s$INS
set.seed(123)
cv_lasso <- cv.glmnet(x_train, y_train, alpha = 1, nfolds = 10, family = binomial(link=logit))
#get coefficients
best_lambda = cv_lasso$lambda.min
coefs = as.matrix(coef(cv_lasso, s = best_lambda))
nonzero = coefs[coefs != 0, , drop = FALSE]
#Nonzero coefficents: ACCTAGE, DDA, DDABAL, DEPAMT, CHECKS, DIRDEP, PHONE, TELLER, SAV, SAVBAL,
# AMT, ATMAMT, POS, POSAMT, CD, CDBAL, IRA, IRABAL, INV, INVBAL, MM, MMCRED, CC, SDB, HMVAL,
# BRANCH
colnames(ins_t)
gam1 <- mgcv::gam(INS ~ s(ACCTAGE, k=9) + s(DDA, k=9) + s(DDABAL, k=9) + s(DEPAMT, k=9) + s(CHECKS, k=9) +
s(DIRDEP, k=9) + s(PHONE, k=9) + s(TELLER, k=9) + s(SAV, k=9) + s(SAVBAL, k=9) + s(AMT, k=9) +
s(ATMAMT, k=9) + s(POS, k=9) + s(POSAMT, k=9) + s(CD, k=9) + s(CDBAL, k=9) + s(IRA, k=9) +
s(IRABAL, k=9) + s(INV, k=9) + s(MM, k=9) + s(MMCRED, k=9) + s(CC, k=9) + s(SDB, k=9) +
s(HMVAL, k=9) + s(BRANCH, k=9) +
, data=ins_t, method="REML", family = binomial(link="logit"))
colnames(ins_t)
gam1 <- mgcv::gam(INS ~ s(ACCTAGE, k=9) + s(DDA, k=9) + s(DDABAL, k=9) + s(DEPAMT, k=9) + s(CHECKS, k=9) +
s(DIRDEP, k=9) + s(PHONE, k=9) + s(TELLER, k=9) + s(SAV, k=9) + s(SAVBAL, k=9) + s(AMT, k=9) +
s(ATMAMT, k=9) + s(POS, k=9) + s(POSAMT, k=9) + s(CD, k=9) + s(CDBAL, k=9) + s(IRA, k=9) +
s(IRABAL, k=9) + s(INV, k=9) + s(MM, k=9) + s(MMCRED, k=9) + s(CC, k=9) + s(SDB, k=9) +
s(HMVAL, k=9) + s(BRANCH, k=9), data=ins_t, method="REML", family = binomial(link="logit"))
colnames(ins_t)
gam1 <- mgcv::gam(INS ~ s(ACCTAGE, k=9) + s(DDA, k=9) + s(DDABAL, k=9) + s(DEPAMT, k=9) + s(CHECKS, k=9) +
s(DIRDEP, k=9) + s(PHONE, k=9) + s(TELLER, k=9) + s(SAV, k=9) + s(SAVBAL, k=9) + s(ATM, k=9) +
s(ATMAMT, k=9) + s(POS, k=9) + s(POSAMT, k=9) + s(CD, k=9) + s(CDBAL, k=9) + s(IRA, k=9) +
s(IRABAL, k=9) + s(INV, k=9) + s(MM, k=9) + s(MMCRED, k=9) + s(CC, k=9) + s(SDB, k=9) +
s(HMVAL, k=9) + s(BRANCH, k=9), data=ins_t, method="REML", family = binomial(link="logit"))
colnames(ins_t)
gam1 <- mgcv::gam(INS ~ s(ACCTAGE, k=9) + s(DDA, k=9) + s(DDABAL, k=9) + s(DEPAMT, k=9) + s(CHECKS, k=9) +
s(DIRDEP, k=9) + s(PHONE, k=9) + s(TELLER, k=9) + s(SAV, k=9) + s(SAVBAL, k=9) + s(AMT, k=9) +
s(ATMAMT, k=9) + s(POS, k=9) + s(POSAMT, k=9) + s(CD, k=9) + s(CDBAL, k=9) + s(IRA, k=9) +
s(IRABAL, k=9) + s(INV, k=9) + s(MM, k=9) + s(MMCRED, k=9) + s(CC, k=9) + s(SDB, k=9) +
s(HMVAL, k=9) + s(BRANCH, k=9), data=ins_t, method="REML", family = binomial(link="logit"))
colnames(ins_t)
gam1 <- mgcv::gam(INS ~ s(ACCTAGE, k=9) + s(DDA, k=9) + s(DDABAL, k=9) + s(DEPAMT, k=9) + s(CHECKS, k=9) +
s(DIRDEP, k=9) + s(PHONE, k=9) + s(TELLER, k=9) + s(SAV, k=9) + s(SAVBAL, k=9) + s(ATM, k=9) +
s(ATMAMT, k=9) + s(POS, k=9) + s(POSAMT, k=9) + s(CD, k=9) + s(CDBAL, k=9) + s(IRA, k=9) +
s(IRABAL, k=9) + s(INV, k=9) + s(MM, k=9) + s(MMCRED, k=9) + s(CC, k=9) + s(SDB, k=9) +
s(HMVAL, k=9) + s(BRANCH, k=9), data=ins_t, method="REML", family = binomial(link="logit"))
nonzero_coeffs= c(ACCTAGE, DDA, DDABAL, DEPAMT, CHECKS, DIRDEP, PHONE, TELLER, SAV, SAVBAL,
AMT, ATMAMT, POS, POSAMT, CD, CDBAL, IRA, IRABAL, INV, INVBAL, MM, MMCRED, CC, SDB, HMVAL, BRANCH)
numeric_predictors
numeric_predictors
#Variable selection
#Standardize
ins_t_s <- ins_t %>%
mutate(across(where(is.numeric), scale))
#Perform Lasso regression on training data
x_train <- model.matrix(INS ~ ., ins_t_s)[, -1]
y_train <- ins_t_s$INS
set.seed(123)
cv_lasso <- cv.glmnet(x_train, y_train, alpha = 1, nfolds = 10, family = binomial(link=logit))
#get coefficients
best_lambda = cv_lasso$lambda.min
coefs = as.matrix(coef(cv_lasso, s = best_lambda))
nonzero = coefs[coefs != 0, , drop = FALSE]
#Nonzero coefficents:
numeric_predictors
#Numeric:
ACCTAGE, DDABAL, DEPAMT, CHECKS, PHONE, TELLER, SAVBAL, ATMAMT, POS, POSAMT, CDBAL, IRABAL, INVBAL, MMCRED, HMVAL
#Variable selection
#Standardize
ins_t_s <- ins_t %>%
mutate(across(where(is.numeric), scale))
#Perform Lasso regression on training data
x_train <- model.matrix(INS ~ ., ins_t_s)[, -1]
y_train <- ins_t_s$INS
set.seed(123)
cv_lasso <- cv.glmnet(x_train, y_train, alpha = 1, nfolds = 10, family = binomial(link=logit))
#get coefficients
best_lambda = cv_lasso$lambda.min
coefs = as.matrix(coef(cv_lasso, s = best_lambda))
nonzero = coefs[coefs != 0, , drop = FALSE]
#Nonzero coefficents:
numeric_predictors
#Numeric:
# ACCTAGE, DDABAL, DEPAMT, CHECKS, PHONE, TELLER, SAVBAL, ATMAMT, POS, POSAMT, CDBAL, IRABAL, INVBAL, MMCRED, HMVAL
#Categorical:
# DDA, DIRDEP, SAV, ATM, CD, IRA, INV, MM, CC, SDB, BRANCH
colnames(ins_t)
gam1 <- mgcv::gam(INS ~ s(ACCTAGE, k=9) + DDA + s(DDABAL, k=9) + s(DEPAMT, k=9) + s(CHECKS, k=9) +
DIRDEP + s(PHONE, k=9) + s(TELLER, k=9) + SAV + s(SAVBAL, k=9) ATM +
colnames(ins_t)
gam1 <- mgcv::gam(INS ~ s(ACCTAGE, k=9) + DDA + s(DDABAL, k=9) + s(DEPAMT, k=9) + s(CHECKS, k=9)+
DIRDEP + s(PHONE, k=9) + s(TELLER, k=9) + SAV + s(SAVBAL, k=9) + ATM +
s(ATMAMT, k=9) + s(POS, k=9) + s(POSAMT, k=9) + CD + s(CDBAL, k=9) + IRA +
s(IRABAL, k=9) + INV + MM + s(MMCRED, k=9) + CC + SDB +
s(HMVAL, k=9) + BRANCH, data=ins_t, method="REML", family = binomial(link="logit"))
str(ins_t)
nonzero
categorical_vars <- ins_t %>%
select(where(is.factor) | where(is.character)) %>%
colnames()
categorical_vars <- ins_t %>%
select(where(is.factor)  %>%
colnames()
colnames(ins_t)
gam1 <- mgcv::gam(INS ~ s(ACCTAGE, k=9) + DDA + s(DDABAL, k=9) + s(DEPAMT, k=9) + s(CHECKS, k=9)+
DIRDEP + s(PHONE, k=9) + TELLER + SAV + s(SAVBAL, k=9) + ATM +
s(ATMAMT, k=9) + s(POS, k=9) + s(POSAMT, k=9) + CD + s(CDBAL, k=9) + IRA +
s(IRABAL, k=9) + INV + MM + s(MMCRED, k=9) + CC + SDB +
s(HMVAL, k=9) + BRANCH, data=ins_t, method="REML", family = binomial(link="logit"))
gam_vars = c("ACCTAGE", "DDABAL", "DEPAMT", "CHECKS", "PHONE", "TELLER", "SAVBAL", "ATMAMT", "POS", "POSAMT", "CDBAL", "IRABAL", "INVBAL", "MMCRED", "HMVAL", "DDA", "DIRDEP", "SAV", "ATM", "CD", "IRA", "INV", "MM", "CC", "SDB", "BRANCH")
for (j in gam_vars){
print(j)
}
gam_vars = c("ACCTAGE", "DDABAL", "DEPAMT", "CHECKS", "PHONE", "TELLER", "SAVBAL", "ATMAMT", "POS", "POSAMT", "CDBAL", "IRABAL", "INVBAL", "MMCRED", "HMVAL", "DDA", "DIRDEP", "SAV", "ATM", "CD", "IRA", "INV", "MM", "CC", "SDB", "BRANCH")
for (j in gam_vars){
print(length(unique(ins_t$j)))
}
gam_vars = c("ACCTAGE", "DDABAL", "DEPAMT", "CHECKS", "PHONE", "TELLER", "SAVBAL", "ATMAMT", "POS", "POSAMT", "CDBAL", "IRABAL", "INVBAL", "MMCRED", "HMVAL", "DDA", "DIRDEP", "SAV", "ATM", "CD", "IRA", "INV", "MM", "CC", "SDB", "BRANCH")
for (j in gam_vars){
print(length(unique(ins_t[[j]])))
}
gam_vars = c("ACCTAGE", "DDABAL", "DEPAMT", "CHECKS", "PHONE", "TELLER", "SAVBAL", "ATMAMT", "POS", "POSAMT", "CDBAL", "IRABAL", "INVBAL", "MMCRED", "HMVAL", "DDA", "DIRDEP", "SAV", "ATM", "CD", "IRA", "INV", "MM", "CC", "SDB", "BRANCH")
for (j in gam_vars){
print(paste(j, length(unique(ins_t[[j]]))))
}
gam_vars = c("ACCTAGE", "DDABAL", "DEPAMT", "CHECKS", "PHONE", "TELLER", "SAVBAL", "ATMAMT", "POS", "POSAMT", "CDBAL", "IRABAL", "INVBAL", "MMCRED", "HMVAL", "DDA", "DIRDEP", "SAV", "ATM", "CD", "IRA", "INV", "MM", "CC", "SDB", "BRANCH")
for (j in gam_vars){
print(paste(j, ':', length(unique(ins_t[[j]]))))
}
gam_vars = c("ACCTAGE", "DDABAL", "DEPAMT", "CHECKS", "PHONE", "TELLER", "SAVBAL", "ATMAMT", "POS", "POSAMT", "CDBAL", "IRABAL", "INVBAL", "MMCRED", "HMVAL")
for (j in gam_vars){
print(paste(j, ':', length(unique(ins_t[[j]]))))
}
gam1 <- mgcv::gam(INS ~ s(ACCTAGE, k=9) + DDA + s(DDABAL, k=9) + s(DEPAMT, k=9) + s(CHECKS, k=9)+
DIRDEP + s(PHONE, k=9) + TELLER + SAV + s(SAVBAL, k=9) + ATM +
s(ATMAMT, k=9) + s(POS, k=9) + s(POSAMT, k=9) + CD + s(CDBAL, k=9) + IRA +
s(IRABAL, k=9) + INV + MM + s(MMCRED, k=5) + CC + SDB +
s(HMVAL, k=9) + BRANCH, data=ins_t, method="REML", family = binomial(link="logit"))
# gam1 <- mgcv::gam(INS ~ s(ACCTAGE, k=9) + DDA + s(DDABAL, k=9) + s(DEPAMT, k=9) + s(CHECKS, k=9)+
#         DIRDEP + s(PHONE, k=9) + TELLER + SAV + s(SAVBAL, k=9) + ATM +
#         s(ATMAMT, k=9) + s(POS, k=9) + s(POSAMT, k=9) + CD + s(CDBAL, k=9) + IRA +
#         s(IRABAL, k=9) + INV + MM + s(MMCRED, k=5) + CC + SDB +
#         s(HMVAL, k=9) + BRANCH, data=ins_t, method="REML", family = binomial(link="logit"))
# summary(gam1)
#Taking too long to run: trying k=5
gam1 <- mgcv::gam(INS ~ s(ACCTAGE, k=5) + DDA + s(DDABAL, k=5) + s(DEPAMT, k=5) + s(CHECKS, k=5)+
DIRDEP + s(PHONE, k=5) + TELLER + SAV + s(SAVBAL, k=5) + ATM +
s(ATMAMT, k=5) + s(POS, k=5) + s(POSAMT, k=5) + CD + s(CDBAL, k=9) + IRA +
s(IRABAL, k=5) + INV + MM + s(MMCRED, k=5) + CC + SDB +
s(HMVAL, k=5) + BRANCH, data=ins_t, method="REML", family = binomial(link="logit"))
summary(gam1)
